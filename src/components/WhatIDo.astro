---
import { getCollection } from "astro:content";
const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
import FormattedDate from "@/components/FormattedDate.astro";
import { Icon } from "astro-icon/components";

const bgClasses = [
  "bg-pgreen rounded-full",
  "bg-pblue rounded-2xl",
  "bg-ppink ",
  "bg-pyellow rounded-md",
];

const getRandomClass = () => {
  return bgClasses[Math.floor(Math.random() * bgClasses.length)];
};
---

<section class="flex flex-col text-center gap-4" id="what-we-do">
  <p class="text-pblack">Building together.</p>
  <h2 class="text-4xl font-bold">What We Do</h2>
  
  <!-- Community Activities -->
  <div class="flex flex-wrap justify-center gap-8 py-12">
    <div class="w-72 text-left rounded-3xl border-1 border-black shadow-card group hover:shadow-hover transition px-4 py-6 flex flex-col gap-6">
      <div class="bg-pgreen text-4xl p-2 self-start border-1 border-black shadow-card1 group-hover:shadow-card transition rounded-full">
        <Icon name="web" />
      </div>
      <h4 class="text-xl font-semibold">Tech Meetups & Workshops</h4>
      <p>Casual gatherings to talk about tools, trends, and projects. Connect with fellow developers and learn about the latest in technology.</p>
    </div>
    
    <div class="w-72 text-left rounded-3xl border-1 border-black shadow-card group hover:shadow-hover transition px-4 py-6 flex flex-col gap-6">
      <div class="bg-pblue text-4xl p-2 self-start border-1 border-black shadow-card1 group-hover:shadow-card transition rounded-2xl">
        üìö
      </div>
      <h4 class="text-xl font-semibold">Book Discussions</h4>
      <p>Community meetups where we read and discuss a technical book together. Dive deep into concepts and share insights with peers.</p>
    </div>
    
    <div class="w-72 text-left rounded-3xl border-1 border-black shadow-card group hover:shadow-hover transition px-4 py-6 flex flex-col gap-6">
      <div class="bg-ppink text-4xl p-2 self-start border-1 border-black shadow-card1 group-hover:shadow-card transition">
        üéôÔ∏è
      </div>
      <h4 class="text-xl font-semibold">Hadith Tech Podcast</h4>
      <p>Extending our community conversations to a global stage, connecting with developers and innovators worldwide.</p>
    </div>
  </div>

  <!-- Blog Posts Section -->
  <div class="mt-8">
    <h3 class="text-2xl font-bold mb-6">Latest Events</h3>
    <ul class="flex flex-wrap justify-center gap-8 py-8">
      {
        posts.slice(0, 8).map((post) => {
          const randomClass = getRandomClass();
          return (
            <li class="w-72 text-left rounded-3xl border-1 border-black shadow-card group hover:shadow-hover transition  px-4 py-6 flex flex-col gap-6">
              <a href={`/blog/${post.id}/`} class="flex flex-col gap-4">
                <div
                  class={`${randomClass} text-4xl p-2 self-start border-1 border-black shadow-card1 group-hover:shadow-card transition`}
                >
                  <Icon name={post.data.icon} />
                </div>
                <h4 class="text-xl font-semibold">{post.data.title}</h4>
                <p class="date -mt-4 text-sm font-light">
                  <FormattedDate date={post.data.pubDate} />
                </p>
              </a>
              <div set:html={post.data.description} />
            </li>
          );
        })
      }
    </ul>
    {posts.length > 8 && (
      <div class="flex justify-center mt-8">
        <a
          href="/blog"
          class="bg-pblue px-8 py-3 border-1 border-black rounded-lg shadow-card hover:shadow-hover transition text-white font-semibold"
        >
          Show All
        </a>
      </div>
    )}
  </div>
</section>
